@timevault = angular.module('timevault', ['ngRoute', 'ngResource', 'Devise'])

@timevault.config(['$routeProvider', '$locationProvider', '$httpProvider', ($routeProvider, $locationProvider, $httpProvider) ->
  # Enable HTML5 History API for modern browsers
  $locationProvider.html5Mode(true)

  # Add CSRF tokens
  authToken = $("meta[name=\"csrf-token\"]").attr("content")
  $httpProvider.defaults.headers.common["X-CSRF-TOKEN"] = authToken

  # Add support for HTTP PATCH
  defaults = $httpProvider.defaults.headers
  defaults.patch = defaults.patch || {}
  defaults.patch['Content-Type'] = 'application/json'

  $routeProvider
    .when('/pomodoros', {
      templateUrl: '<%= asset_path("pomodoros/index.html") %>',
      controller: 'PomodoroIndexCtrl'
    })
    .when('/pomodoros/:id', {
      templateUrl: '<%= asset_path("pomodoros/show.html") %>',
      controller: 'PomodoroShowCtrl'
    })
    .when('/users/sign_in', {
      templateUrl: '<%= asset_path("users/sign_in.html") %>',
      controller: 'UserSignInCtrl'
    })
    .otherwise({
      templateUrl: '<%= asset_path("home.html") %>',
      controller: 'HomeCtrl'
    })
])
